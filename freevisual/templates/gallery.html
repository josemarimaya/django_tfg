{% extends 'layouts/base.html'%}

{% load static %}

{% block content %}


<div class="album mt-2 bg-light">
    <h1 class="mt-3 text-center"> Esta es la galería</h1>

    <div class="d-flex justify-content-center">
      <form class="d-flex justify-content-center align-items-center" role="search" style="width: 500px; margin-bottom: 20px;" method="GET" action="">
        <input class="form-control me-2" type="search" placeholder="Busca tu contenido favorito" name="query" aria-label="Search" value="{{ query|default:'' }}">
        <button class="btn btn-info me-2" type="submit" style="min-width: 100px;">Buscar</button>
  
      </form>
    
    </div>
    
    <div class="d-flex justify-content-center mb-3">
      <button type="button" class="btn btn-primary" onclick="toggleValidTags()"
       style="width: 500px;">Etiquetas válidas</button>
    </div>

    <div class="d-flex justify-content-center">
      <div id="valid-tags" style="display:none; margin-left: 5px; margin-top: 5px; margin-bottom: 10px;">
        {% if user.is_authenticated %}
          <h5>Etiquetas No Pro:</h5>
          {% for tag in valid_tags.non_pro %}
          <span class="badge bg-warning" 
          style="font-size: 1rem; padding: 5px 5px; margin-left: 3px; margin-top: 3px;">
          #{{tag.name}}
          </span>
          {% endfor %}

          <h5 style="margin-top: 10px;">Etiquetas Pro</h5>
          
          {% for tag in valid_tags.pro %}
          <span class="badge bg-success" 
          style="font-size: 1rem; padding: 5px 5px; margin-left: 3px; margin-top: 3px;">
          #{{tag.name}}
          </span>
          {% endfor %}
        {% else %}
          <h5>Etiquetas que puedes usar: </h5>
          {% for tag in valid_tags.non_pro %}
          <span class="badge bg-warning" 
          style="font-size: 1rem; padding: 5px 5px; margin-left: 3px; margin-top: 3px;">
          #{{tag.name}}
          </span>
          {% endfor %}
        {% endif %}
      </div>
    </div>
    
    <div class="row">
      {% for image in images %}
        <div class="col-md-4 mb-4">
          <div class="card">
            <img src="{{ image.image.url }}" class="card-img-top" alt="{{ image.title }}">
            <div class="card-body">
              <h5 class="card-title">{{ image.title }}</h5>
              <p class="card-text">{{ image.description }}</p>
              {%if user.is_authenticated %}
                {%if image.tags.exists%}

                  {%for tag in image.tags.all%}
                      {%if tag.is_pro%}
                      <span class="badge bg-success" 
                      style="font-size: 1rem; padding: 5px 5px;">
                      {{tag.name}}
                      </span>
                      {%else%}
                      <span class="badge bg-warning" 
                      style="font-size: 1rem; padding: 5px 5px;">
                      {{tag.name}}
                      </span>
                      {%endif%}
                  {%endfor%}
                
                {%endif%}
              {% else %}
                  {%if image.tags.exists%}

                    {%for tag in image.tags.all%}
                        {%if not tag.is_pro%}
                        <span class="badge bg-warning" 
                        style="font-size: 1rem; padding: 5px 5px;">
                        {{tag.name}}
                        </span>
                        {%endif%}
                    {%endfor%}
                  {%endif%}
              {%endif%}
              <p class="text-muted">Uploaded on: {{ image.uploaded_at|date:"F j, Y, g:i a" }}</p>
              <div class="d-flex justify-content-center" >
                <a href="{% url 'image_detail' image.id %}" class="btn btn-secondary" style="margin-right: 5px;"> Quiero ver más </a>
                {% if user == image.owner %}
                <form action="{% url 'delete_image' image.id %}" method="post" style="margin-right: 5px;">
                    {%csrf_token%}
                    <button type="button" class="btn btn-danger" data-bs-toggle="modal" style="margin-right: 2px;" data-bs-target="#deleteModal{{ image.id }}">
                      Eliminar
                  </button>
                </form>

                <div class="modal fade" id="deleteModal{{ image.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ image.id }}" aria-hidden="true">
                  <div class="modal-dialog">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h5 class="modal-title" id="deleteModalLabel{{ image.id }}">Confirmar Eliminación</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                              ¿Estás seguro de que quieres borrar la imagen?
                          </div>
                          <div class="modal-footer">
                              
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>

                             
                              <form action="{% url 'delete_image' image.id %}" method="post">
                                  {% csrf_token %}
                                  <button type="submit" class="btn btn-danger">Eliminar</button>
                              </form>
                          </div>
                      </div>
                  </div>
              </div>

                <a href="{% url 'edit_image' image.id%}" class="btn btn-primary" style="margin-right: 5px;">Editar</a>
                {% endif %}
              </div>
              
            </div>
          </div>
        </div>

        {% if forloop.counter|divisibleby:3 and not forloop.last %}
          </div><div class="row"> 
        {% endif %}
      {% endfor %}
    </div>

    

</div>


    

{% endblock %}


{% block javascript %}
<script>
    function toggleValidTags() {
        var tagsDiv = document.getElementById('valid-tags');
        if (tagsDiv.style.display === "none" || tagsDiv.style.display === "") {
            tagsDiv.style.display = "block";
        } else {
            tagsDiv.style.display = "none";
        }
    }
</script>
{% endblock %}